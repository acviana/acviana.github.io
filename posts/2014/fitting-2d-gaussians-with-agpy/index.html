<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fitting 2D Gaussians with agpy</title>
  <meta name="author" content="Alex C. Viana">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://acviana.github.io/favicon.png" rel="icon">
  <link href="http://acviana.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://acviana.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://acviana.github.io/theme/js/ender.js"></script>
  <script src="http://acviana.github.io/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://acviana.github.io/">The Other Side of the Screen</a></h1>
    <h2>"On the other side of the screen it all seems so easy." - Tron (1982)</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://acviana.github.io/" rel="subscribe-rss">RSS</a></li>
</ul>

<!-- TODO: add search here
<form action="" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:http://acviana.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
-->

<ul class="main-navigation">
      <li><a href="http://acviana.github.io/pages/about.html">About</a></li>
      <li><a href="http://acviana.github.io/pages/disclaimer.html">Disclaimer</a></li>
    <!-- TODO: add categories here? -->
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Fitting 2D Gaussians with agpy</h1>
      <p class="meta"><time datetime="2014-01-30T00:00:00" pubdate>2014-01-30</time></p>
</header>

  <div class="entry-content"><p><strong>Update 01/30/2014:</strong> Adam has split his <code>gaussfitter</code> code off into it's own GitHub repository <a href="https://github.com/keflavich/gaussfitter/blob/master/gaussfitter/gaussfitter.py">here</a> (<em>"PR's Welcome!"</em>). This removes some dependencies and changes the import statement but as of right now everything else is the same. I've maintained the old links to the original agpy repo in the post below but please use the above repo for the latest version.</p>
<hr />
<p>After some <a href="http://acviana.github.io/posts/2013/counting-to-10-million-stars/">initial work</a> with fitting WFC3 UVIS PSFs with 1D Gaussians through the x and y axis I decided to look at 2d Guassian fitting as well. I was disappointed to find there wasn't already a canned procedure to do this in something like SciPy. But after some digging I decided to use <a href="http://casa.colorado.edu/~ginsbura/">Adam Ginsburg's</a> personal agpy library. I briefly met Adam at the <a href="http://dotastronomy.com/">dotAstronomy</a> conference last year in Boston. He's a contributor to <a href="http://www.astropy.org/">AstroPY</a>, <a href="http://astroquery.readthedocs.org/en/latest/">AstroQuery</a>, and <a href="http://aplpy.github.io/">AplPy</a> so I had a hunch I could trust his code and it's worked out great. </p>
<p>You can clone the repo <a href="https://github.com/keflavich/agpy">here</a>. There are a couple of dependencies but I only satisfied the AstroPy and Numpy requirements and that was enough to run the <code>gaussfit</code> function. </p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">agpy</span> <span class="kn">import</span> <span class="n">gaussfitter</span>

<span class="n">mpfit</span><span class="p">,</span> <span class="n">psf_fit</span> <span class="o">=</span> <span class="n">gaussfitter</span><span class="o">.</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">psf_array</span><span class="p">,</span> <span class="n">returnmp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                                      <span class="n">returnfitimage</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Using <code>gaussfit</code> without the <code>returnmp</code> or <code>returnfitimage</code> parameters just returns a list with the following model parameters (in order): </p>
<ul>
<li>height</li>
<li>amplitude</li>
<li>x</li>
<li>y</li>
<li>width_x</li>
<li>width_y</li>
<li>rotation angle. </li>
</ul>
<p>Adding <code>returnfitimage=True</code> will also return a NumPy array of the model with the same dimensions as the input data. Lastly, setting <code>returnmp=True</code> will return a <code>mpfit</code> instance, which is the class used to generate the fit. The class is defined in the <code>agpy.mpfit_custom</code> module. The <code>mpfit</code> instance contains two useful attributes, <code>mpfit.params</code> which is the same list of parameters that <code>guassfit</code> returns by default, and <code>mpfits.covar</code> which is a 7x7 <a href="http://en.wikipedia.org/wiki/Covariance_matrix">covariance matrix</a> for the 7 model parameters. </p>
<p>It took me a little bit of work to figure out all these outputs but they were exactly what I needed so I followed up with Adam and submitted my <em>first</em> FOSS PR on GitHub with some documentation <a href="https://github.com/keflavich/agpy/pull/2">improvements</a>. It's a small contribution but still a personal milestone.</p>
<p>Finally, I made a plot of the input data, the model, and the residual (difference) at two different scales. I'm definitely happy with this and am looking forward to digging into the covariance matrix a little more to really understand how well I'm fitting these PSFs.</p>
<p><img style="width: 800px; max-width: 100%; height: auto;" alt="Oops, something broke." src="/images/2d-gaussians.png" /></p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Alex C. Viana</span>
  </span>
<time datetime="2014-01-30T00:00:00" pubdate>2014-01-30</time>  <span class="categories">
    <a class="category" href="http://acviana.github.io/tag/python.html">python</a>
    <a class="category" href="http://acviana.github.io/tag/code.html">code</a>
    <a class="category" href="http://acviana.github.io/tag/psf.html">psf</a>
    <a class="category" href="http://acviana.github.io/tag/uvis.html">uvis</a>
    <a class="category" href="http://acviana.github.io/tag/wfc3.html">wfc3</a>
    <a class="category" href="http://acviana.github.io/tag/milestones.html">milestones</a>
    <a class="category" href="http://acviana.github.io/tag/plots.html">plots</a>
    <a class="category" href="http://acviana.github.io/tag/hst.html">hst</a>
  </span>
</p>    </footer>
  </article>
  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://acviana.github.io/posts/2014/fitting-2d-gaussians-with-agpy/">Fitting 2D Gaussians with agpy</a>
      </li>
      <li class="post">
          <a href="http://acviana.github.io/posts/2014/numpy-arrays-and-sql/">Working with NumPy Arrays and SQL</a>
      </li>
      <li class="post">
          <a href="http://acviana.github.io/posts/2014/faster-file-checking-with-sets/">Faster File Existence Testing with Sets</a>
      </li>
      <li class="post">
          <a href="http://acviana.github.io/posts/2014/2014-summer-internship-opportunity/">2014 Summer Internship Opportunity</a>
      </li>
      <li class="post">
          <a href="http://acviana.github.io/posts/2013/guilty-as-charged/">Guilty As Charged</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://acviana.github.io/category/work.html">Work</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://acviana.github.io/tag/uvis.html">uvis</a>,    <a href="http://acviana.github.io/tag/code.html">code</a>,    <a href="http://acviana.github.io/tag/humor.html">humor</a>,    <a href="http://acviana.github.io/tag/mtpipeline.html">mtpipeline</a>,    <a href="http://acviana.github.io/tag/python.html">python</a>,    <a href="http://acviana.github.io/tag/wfc3.html">wfc3</a>,    <a href="http://acviana.github.io/tag/database.html">database</a>,    <a href="http://acviana.github.io/tag/psf.html">psf</a>,    <a href="http://acviana.github.io/tag/devops.html">devops</a>,    <a href="http://acviana.github.io/tag/wfpc2.html">wfpc2</a>,    <a href="http://acviana.github.io/tag/acs.html">acs</a>,    <a href="http://acviana.github.io/tag/jwst.html">jwst</a>,    <a href="http://acviana.github.io/tag/milestones.html">milestones</a>,    <a href="http://acviana.github.io/tag/hst.html">hst</a>,    <a href="http://acviana.github.io/tag/git.html">git</a>,    <a href="http://acviana.github.io/tag/plots.html">plots</a>,    <a href="http://acviana.github.io/tag/pelican.html">pelican</a>  </section>


    <section>
        <h1>Social</h2>
        <ul>
            <li><a href="http://acviana.github.io/" type="application/rss+xml" rel="alternate">RSS</a></li>
            <li><a href="https://twitter.com/AlexVianaPro" target="_blank">Twitter</a></li>
            <li><a href="https://github.com/acviana" target="_blank">GitHub</a></li>
            <li><a href="http://www.linkedin.com/pub/alex-viana/49/1b8/83" target="_blank">LinkedIn</a></li>
            <li><a href="http://stackoverflow.com/users/1216837/acv" target="_blank">StackOverflow</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h2>
        <ul>
            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
            <li><a href="http://software-carpentry.org/" target="_blank">Software Carpentry</a></li>
        </ul>
    </section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Alex C. Viana -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45960611-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-45960611-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'theothersideofthescreen';
          var disqus_identifier = '/posts/2014/fitting-2d-gaussians-with-agpy/';
          var disqus_url = 'http://acviana.github.io/posts/2014/fitting-2d-gaussians-with-agpy/';
          var disqus_title = 'Fitting 2D Gaussians with agpy';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>